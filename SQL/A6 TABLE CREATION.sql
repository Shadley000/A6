drop table if exists ALARMDATA;
drop table if exists ALARMTYPE;
drop table if exists ALARMSTATUS;
drop table if exists PRIORITY;
drop table if exists MESSAGETYPE;
drop table if exists SUBSYSTEM;
drop table if exists SYSTEM;
drop table if exists ALARMLOAD;
drop table if exists ERRORLOG;
drop table if exists ALARMFILE;
drop table if exists USERSPERMISSIONS;
drop table if exists PERMISSION;
drop table if exists USERS;
drop table if exists INSTALLATION;
drop table if exists SHIP;
drop table if exists VENDOR;
drop table if exists CONTRACTOR;

CREATE TABLE CONTRACTOR (
    ID INT AUTO_INCREMENT,
    NNAME VARCHAR(64),
    LOGO VARCHAR(128),
    PRIMARY KEY (ID)
);

CREATE TABLE VENDOR (
    ID INT AUTO_INCREMENT,
    NNAME VARCHAR(64),
    LOGO VARCHAR(128),
    PRIMARY KEY (ID)
);

CREATE TABLE SHIP (
    ID INT AUTO_INCREMENT,
    NNAME VARCHAR(64),
    LOGO VARCHAR(128),
    PRIMARY KEY (ID)
);

CREATE TABLE INSTALLATION (
    ID INT AUTO_INCREMENT,
    ID_VENDOR INT,
    ID_SHIP INT,
    ID_CONTRACTOR INT,
    NNAME VARCHAR(64),
    DATADIRECTORY VARCHAR(256),
    PARSERNAME VARCHAR(64),
    PRIMARY KEY (ID),
    FOREIGN KEY (ID_VENDOR) REFERENCES VENDOR (ID),
    FOREIGN KEY (ID_SHIP) REFERENCES SHIP (ID),
    FOREIGN KEY (ID_CONTRACTOR) REFERENCES CONTRACTOR (ID),
    UNIQUE (DATADIRECTORY)
);

CREATE TABLE USERS (
    ID INT AUTO_INCREMENT,
    NNAME VARCHAR(32),
    USER_PASSWORD VARCHAR(32),
    PRIMARY KEY (ID),
    UNIQUE (NNAME)
);

CREATE TABLE PERMISSION (
    ID INT AUTO_INCREMENT,
    NNAME VARCHAR(32),
    PRIMARY KEY (ID)
);

CREATE TABLE USERSPERMISSIONS (
    ID INT AUTO_INCREMENT,
    ID_USERS INT,
    ID_INSTALLATION INT,
    ID_PERMISSION INT,
    PRIMARY KEY (ID),
    FOREIGN KEY (ID_USERS)
        REFERENCES USERS (ID),
    FOREIGN KEY (ID_INSTALLATION)
        REFERENCES INSTALLATION (ID),
    FOREIGN KEY (ID_PERMISSION)
        REFERENCES PERMISSION (ID)
);

CREATE TABLE ALARMFILE(
 	ID INT AUTO_INCREMENT,
    ID_INSTALLATION INT,
    FILE_NAME VARCHAR(128),
	LOAD_DATE TIMESTAMP default now(),
    DATA_LINES INT default 0,
    DATA_INSERTED INT default 0,
    DATA_SKIPPED INT default 0,
    DATA_ERROR INT default 0,
    PRIMARY KEY (ID),
   FOREIGN KEY (ID_INSTALLATION)
        REFERENCES INSTALLATION (ID)
);

CREATE TABLE ERRORLOG (
    ID INT AUTO_INCREMENT,
    ID_INSTALLATION INT,
    ID_FILE INT,
    ERROR_MESSAGE VARCHAR(512),
    ORIGINAL_TEXT VARCHAR(512),
    LINENUMBER INT,
    PRIMARY KEY (ID),
    FOREIGN KEY (ID_FILE)
        REFERENCES ALARMFILE (ID),
    FOREIGN KEY (ID_INSTALLATION)
        REFERENCES INSTALLATION (ID)
);

CREATE TABLE ALARMLOAD (
    ID INT AUTO_INCREMENT,
    ID_INSTALLATION INT,
    ID_FILE INT,
    ALARMTIME DATETIME,
    SYSTEM VARCHAR(64),
    SUBSYSTEM VARCHAR(64),
    MESSAGETYPE VARCHAR(64),
    TAGNAME VARCHAR(32),
    PRIORITY VARCHAR(16),
    ALARMSTATUS VARCHAR(16),
    DESCRIPTION VARCHAR(256),
    ID_ALARMTYPE INT default 0,
    ID_SYSTEM INT default 0,
    ID_SUBSYSTEM INT default 0,
    ID_MESSAGETYPE INT default 0,
    ID_PRIORITY INT default 0,
    ID_ALARMSTATUS INT DEFAULT 0,
    ALREADY_EXISTS INT DEFAULT 0,
    PRIMARY KEY (ID),
    FOREIGN KEY (ID_INSTALLATION)
        REFERENCES INSTALLATION (ID),
	FOREIGN KEY (ID_FILE)
        REFERENCES ALARMFILE (ID)
);

CREATE TABLE SYSTEM (
    ID INT AUTO_INCREMENT,
    ID_INSTALLATION INT,
    NNAME VARCHAR(64),
    DESCRIPTION VARCHAR(256),
    PRIMARY KEY (ID),
    FOREIGN KEY (ID_INSTALLATION)
        REFERENCES INSTALLATION (ID)
);

CREATE TABLE SUBSYSTEM (
    ID int AUTO_INCREMENT,
    ID_INSTALLATION INT,
    NNAME VARCHAR(64),
    DESCRIPTION VARCHAR(256),
    PRIMARY KEY (ID),
    FOREIGN KEY (ID_INSTALLATION) REFERENCES INSTALLATION (ID)
);
    
CREATE TABLE MESSAGETYPE (
    ID int  AUTO_INCREMENT,
    ID_INSTALLATION INT,
    NNAME VARCHAR(64),
    DESCRIPTION VARCHAR(256),
    PRIMARY KEY (ID),
    FOREIGN KEY (ID_INSTALLATION) REFERENCES INSTALLATION (ID)
);

CREATE TABLE PRIORITY (
    ID int  AUTO_INCREMENT,
    ID_INSTALLATION INT,
    NNAME VARCHAR(64),
    DESCRIPTION VARCHAR(256),
    PRIMARY KEY (ID),
    FOREIGN KEY (ID_INSTALLATION) REFERENCES INSTALLATION (ID)
);

CREATE TABLE ALARMSTATUS (
    ID int  AUTO_INCREMENT,
    ID_INSTALLATION INT,
    NNAME VARCHAR(64),
    DESCRIPTION VARCHAR(256),
    PRIMARY KEY (ID),
    FOREIGN KEY (ID_INSTALLATION) REFERENCES INSTALLATION (ID)
);
    
CREATE TABLE ALARMTYPE (
    ID INT  AUTO_INCREMENT,
    ID_INSTALLATION INT,
    ID_SYSTEM INT,
    ID_SUBSYSTEM INT,
    ID_MESSAGETYPE INT,
    ID_PRIORITY INT,
    TAGNAME VARCHAR(32),
    DESCRIPTION VARCHAR(256),
    PRIMARY KEY (ID),
    FOREIGN KEY (ID_INSTALLATION)
        REFERENCES INSTALLATION (ID),
    FOREIGN KEY (ID_SYSTEM)
        REFERENCES SYSTEM (ID),
    FOREIGN KEY (ID_SUBSYSTEM)
        REFERENCES SUBSYSTEM (ID),
    FOREIGN KEY (ID_MESSAGETYPE)
        REFERENCES MESSAGETYPE (ID),
    FOREIGN KEY (ID_PRIORITY)
        REFERENCES PRIORITY (ID),
    UNIQUE (ID_INSTALLATION , ID_SYSTEM , ID_SUBSYSTEM , ID_MESSAGETYPE , ID_PRIORITY , TAGNAME , DESCRIPTION)
);

CREATE TABLE ALARMDATA (
    ID INT AUTO_INCREMENT,
    ID_INSTALLATION INT,
    ID_FILE INT,
    ID_ALARMTYPE INT,
    ID_ALARMSTATUS INT,
    ALARMTIME DATETIME,
    PRIMARY KEY (ID),
    FOREIGN KEY (ID_INSTALLATION)
        REFERENCES INSTALLATION (ID),
	FOREIGN KEY (ID_FILE)
        REFERENCES ALARMFILE (ID),
    FOREIGN KEY (ID_ALARMTYPE)
        REFERENCES ALARMTYPE (ID),
     FOREIGN KEY (ID_ALARMSTATUS)
        REFERENCES ALARMSTATUS (ID)
);

INSERT INTO CONTRACTOR (ID,NNAME,LOGO) VALUES (1,"Ocean Diamond","images\Diamond\Diamond_Offshore.png");
INSERT INTO CONTRACTOR (ID,NNAME,LOGO) VALUES (2,"Demo Client","images\DEMO\DEMO_Client.png");
INSERT INTO CONTRACTOR (ID,NNAME,LOGO) VALUES (3,"Transocean","images\Transocean\DEMO_Client.png");


INSERT INTO SHIP (ID,NNAME,LOGO) VALUES (1,"BlackRhino","images\Diamond\BlackRhino.png");
INSERT INTO SHIP (ID,NNAME,LOGO) VALUES (2,"BlackLion","images\Diamond\BlackLion.png");
INSERT INTO SHIP (ID,NNAME,LOGO) VALUES (3,"BlackHawk","images\Diamond\BlackHawk.png");
INSERT INTO SHIP (ID,NNAME,LOGO) VALUES (4,"BlackHornet","images\Diamond\BlackHornet.png");
INSERT INTO SHIP (ID,NNAME,LOGO) VALUES (5,"Demo Rig 1","images\DEMO\DEMO_platform.png");
INSERT INTO SHIP (ID,NNAME,LOGO) VALUES (6,"Demo Rig 2","images\DEMO\DEMO_platform.png");
INSERT INTO SHIP (ID,NNAME,LOGO) VALUES (7,"Sedco Energy","images\Transocean\DEMO_platform.png");
INSERT INTO SHIP (ID,NNAME,LOGO) VALUES (8,"Cajun Express","images\Transocean\DEMO_platform.png");

INSERT INTO VENDOR (ID,NNAME,LOGO) VALUES (1,"NOV Cyberbase","images\vendor\nov.png");
INSERT INTO VENDOR (ID,NNAME,LOGO) VALUES (2,"Kongsberg VMS","images\vendor\kongsberg.png");
INSERT INTO VENDOR (ID,NNAME,LOGO) VALUES (3,"NOV Amphieon","images\vendor\nov.png");

INSERT INTO INSTALLATION(ID_CONTRACTOR,ID_SHIP,ID_VENDOR,NNAME,DATADIRECTORY,PARSERNAME) VALUES (1,1,2,"BlackRhino Kongsberg",		"BlackRhinoKM",		"KM1");
INSERT INTO INSTALLATION(ID_CONTRACTOR,ID_SHIP,ID_VENDOR,NNAME,DATADIRECTORY,PARSERNAME) VALUES (1,1,1,"BlackRhino NOV",			"BlackRhinoNOV",	"NOV1");
INSERT INTO INSTALLATION(ID_CONTRACTOR,ID_SHIP,ID_VENDOR,NNAME,DATADIRECTORY,PARSERNAME) VALUES (1,2,2,"BlackLion Kongsberg",		"BlackLionKM",		"KM1");
INSERT INTO INSTALLATION(ID_CONTRACTOR,ID_SHIP,ID_VENDOR,NNAME,DATADIRECTORY,PARSERNAME) VALUES (1,2,1,"BlackLion NOV",				"BlackLionNOV",		"NOV1");
INSERT INTO INSTALLATION(ID_CONTRACTOR,ID_SHIP,ID_VENDOR,NNAME,DATADIRECTORY,PARSERNAME) VALUES (1,3,2,"BlackHawk Kongsberg",		"BlackHawkKM",		"KM1");
INSERT INTO INSTALLATION(ID_CONTRACTOR,ID_SHIP,ID_VENDOR,NNAME,DATADIRECTORY,PARSERNAME) VALUES (1,3,1,"BlackHawk NOV",				"BlackHawkNOV",		"NOV1");
INSERT INTO INSTALLATION(ID_CONTRACTOR,ID_SHIP,ID_VENDOR,NNAME,DATADIRECTORY,PARSERNAME) VALUES (1,4,2,"BlackHornet Kongsberg",		"BlackHornetKM",	"KM1");
INSERT INTO INSTALLATION(ID_CONTRACTOR,ID_SHIP,ID_VENDOR,NNAME,DATADIRECTORY,PARSERNAME) VALUES (1,4,1,"BlackHornet NOV",			"BlackHornetNOV",	"NOV1");
INSERT INTO INSTALLATION(ID_CONTRACTOR,ID_SHIP,ID_VENDOR,NNAME,DATADIRECTORY,PARSERNAME) VALUES (2,5,2,"Ship 1 Kongsberg",			"Ship1KM",			"KM1");
INSERT INTO INSTALLATION(ID_CONTRACTOR,ID_SHIP,ID_VENDOR,NNAME,DATADIRECTORY,PARSERNAME) VALUES (2,5,1,"Ship 1 NOV",				"Ship1NOV",			"NOV1");
INSERT INTO INSTALLATION(ID_CONTRACTOR,ID_SHIP,ID_VENDOR,NNAME,DATADIRECTORY,PARSERNAME) VALUES (2,6,2,"Ship 2 Kongsberg",			"Ship2KM",			"KM1");
INSERT INTO INSTALLATION(ID_CONTRACTOR,ID_SHIP,ID_VENDOR,NNAME,DATADIRECTORY,PARSERNAME) VALUES (2,6,1,"Ship 2 NOV",				"Ship2NOV",			"NOV1");
INSERT INTO INSTALLATION(ID_CONTRACTOR,ID_SHIP,ID_VENDOR,NNAME,DATADIRECTORY,PARSERNAME) VALUES (3,7,3,"Sedco Energy Amphieon",		"SedcoEnergyNOV",	"NOV1");
INSERT INTO INSTALLATION(ID_CONTRACTOR,ID_SHIP,ID_VENDOR,NNAME,DATADIRECTORY,PARSERNAME) VALUES (3,8,3,"Cajun Express Amphieon",	"CajunExpressNOV",	"NOV1");

INSERT INTO USERS (NNAME,USER_PASSWORD) VALUES ("admin","supersecret");
INSERT INTO USERS (NNAME,USER_PASSWORD) VALUES ("guest","password");
INSERT INTO USERS (NNAME,USER_PASSWORD) VALUES ("diamond","diamond123");
INSERT INTO USERS (NNAME,USER_PASSWORD) VALUES ("blackrhino","diamond123");
INSERT INTO USERS (NNAME,USER_PASSWORD) VALUES ("transocean","ocean123");

INSERT INTO PERMISSION(NNAME) VALUES ("Read");
INSERT INTO PERMISSION(NNAME) VALUES ("Edit");

-- SET UP ADMINISTRATOR

INSERT INTO USERSPERMISSIONS(ID_USERS,ID_INSTALLATION,ID_PERMISSION) 
	SELECT U.ID,I.ID,P.ID 
    FROM USERS U, INSTALLATION I, PERMISSION P
    WHERE U.NNAME = "admin";
    
-- SET UP GUEST

INSERT INTO USERSPERMISSIONS(ID_USERS,ID_INSTALLATION,ID_PERMISSION) 
	SELECT U.ID, I.ID,P.ID 
    FROM USERS U, INSTALLATION I, PERMISSION P
    WHERE
		U.NNAME = "guest"
		AND P.NNAME = "READ";

-- SET UP DIAMOND

INSERT INTO USERSPERMISSIONS(ID_USERS,ID_INSTALLATION,ID_PERMISSION) 
	SELECT U.ID,I.ID,P.ID 
    FROM USERS U, INSTALLATION I, PERMISSION P, CONTRACTOR C, SHIP S 
    WHERE 
		U.NNAME = "diamond"
		AND I.ID_CONTRACTOR = C.ID
        AND I.ID_SHIP = S.ID
		AND C.NNAME = "Ocean Diamond"
        AND S.NNAME = "blackrhino";
        
INSERT INTO USERSPERMISSIONS(ID_USERS,ID_INSTALLATION,ID_PERMISSION) 
	SELECT U.ID,I.ID,P.ID 
    FROM USERS U, INSTALLATION I, PERMISSION P, CONTRACTOR C 
    WHERE 
		U.NNAME = "diamond"
		AND I.ID_CONTRACTOR = C.ID
		AND C.NNAME = "Ocean Diamond";
        
-- SET UP TRANSOCEAN        
INSERT INTO USERSPERMISSIONS(ID_USERS,ID_INSTALLATION,ID_PERMISSION) 
	SELECT U.ID,I.ID,P.ID 
    FROM USERS U, INSTALLATION I, PERMISSION P, CONTRACTOR C 
    WHERE 
		U.NNAME = "transocean"
		AND I.ID_CONTRACTOR = C.ID
		AND C.NNAME = "Transocean";
        

